/**
 *
 *	FUNCTION JS
 *	/etc/designs/family/js/goods_detail.js
 *
 */

if(typeof util === 'undefined') var util = {};
(function () {
	"use strict;"

	$(function(){
		new Load();
	})

	/**
	 * @class Load
	 * @sumally 全ページロード時共通処理
	 */
	var Load = (function(){
		/**
		 * @constructor
		 */
		function construct() {
			var _this = this;

			_this.setMainimgeSize();
			_this.setMainimgeChange();
			_this.setGoodsListSlide();
			_this.setNavFootList();
			_this.setImageBoxSize();

			// Tポイントプラスキャンペーン ボックス高さ揃え
			$('.js-hlg').rjs_hlg();

			$(window).resize(function() {
				_this.setMainimgeSize();
				_this.setImageBoxSize();
			});

			// webフォント適用後に処理
			$(window).load(function() {
				$('.ly-mod-infoset5-txt').dotdotdot({
					watch: 'window',
					wrap : 'letter'
				});
				_this.setMainimgeSize();
				_this.setImageBoxSize();
			});

		};


		/**
		 * @sumally フッターローカルナビリスト
		 * 空セルを追加する
		 */
		construct.prototype.setNavFootList = function () {

			$navfoot = $('.js-nav-foot');

			if ($navfoot.length > 0) {

				var clm_pc = 6;
				var add_pc_tmp = '';

				var list_len = $navfoot.find('.ly-list-first li').length;
				var add_pc_len = clm_pc - (list_len % clm_pc);

				if (add_pc_len != clm_pc) {
					for(i=0; i<add_pc_len; i++) {
						add_pc_tmp += '<li class="ly-pc-blank"><span></span></li>';
					}
					$navfoot.find('.ly-list-first').append(add_pc_tmp);
				}

			}

		};


		/**
		 * @sumally 商品一覧
		 * スライド枚数：5枚以上
		 */
		construct.prototype.setGoodsListSlide = function () {

			var _this = this;
			var pcflg;
			var winW;

			$goodslistarea = $('.js-goods-list-area');

			if($goodslistarea.length > 0) {

				$goodslistarea.each(function(i) {
					var $tgtarea = $(this);
					var $tgt = $tgtarea.find('.js-goods-list');

					// スライド対象のDOMを取得しておく
					var slideHtml = $tgtarea.html();

					if (rjs.checkUA.widthPC) {
						pcflg = true;
					} else {
						pcflg = false;
					}

					var timer = false;

					if (rjs.checkUA.widthPC) {
						_this.setGoodsListSlideRun($tgtarea, $tgt);
					}

				});

			}

		};
		construct.prototype.setGoodsListSlideRun = function () {

			var $slidelist = $('.js-bnrslide-list');
			var $slidelists = $slidelist.children('.ly-bnrslide-list-inner');
			var slide_len = $slidelists.length;

			var $bnrslide = $('.js-goods-list').lightSlider({
				item: 5,
				loop: false,
				pager: false,
				controls: false,
				enableDrag: false,
				slideMove: 1,
				slideMargin:30,
				easing: 'easeOutQuad',
				speed: 600
			});

			$('.ly-slide-btn-next a').off('click');
			$('.ly-slide-btn-next a').on('click', function(e) {
				$bnrslide.goToNextSlide();
				e.preventDefault();
			});
			$('.ly-slide-btn-prev a').off('click');
			$('.ly-slide-btn-prev a').on('click', function(e) {
				$bnrslide.goToPrevSlide();
				e.preventDefault();
			});

		};


		/**
		 * @sumally メインイメージ
		 * スライド枚数：1～3枚
		 */
		construct.prototype.setMainimgeChange = function () {

			var $mainimgList = $('.js-mainimage-list');
			var $mainimgLists = $mainimgList.children();
			var $thumbimgList = $('.js-thumbimg-list');
			var $thumbimgLists = $thumbimgList.children();

			$mainimgLists.hide();
			$mainimgLists.eq(0).show();
			$thumbimgLists.eq(0).addClass('ly-act');

			$thumbimgLists.on('click', function(e) {
				var index = $thumbimgLists.index(this);
				$mainimgLists.hide();
				$mainimgLists.eq(index).show();
				$thumbimgLists.removeClass('ly-act');
				$thumbimgLists.eq(index).addClass('ly-act');

				e.preventDefault();
			});

		};


		/**
		 * @sumally メインイメージ サイズ計算
		 */
		construct.prototype.setMainimgeSize = function () {

			var areaW = 480;
			var areaH = 480;
			var img_w = $('.ly-mainimage-area').width();
			var img_h = Math.floor(img_w * (areaH / areaW));
			$('.js-mainimage-size').css({'width': img_w + 'px'});
			$('.js-mainimage-size').css({'height': img_h + 'px'});
			$('.js-mainimage-size img').css({'max-height': img_h + 'px'});
			$('.js-mainimage-size img').css({'max-width': img_w + 'px'});

			var thumb_w = $('.js-mainimage-area .ly-goods-thumbimg-list li').width();
			var thumb_h = Math.floor(thumb_w * (areaH / areaW));
			$('.js-thumbimg-size').css({'width': thumb_w + 'px'});
			$('.js-thumbimg-size').css({'height': thumb_h + 'px'});
			$('.js-thumbimg-size img').css({'max-height': thumb_h + 'px'});
			$('.js-thumbimg-size img').css({'max-width': thumb_w + 'px'});

		};

		/**
		 * @sumally 商品情報リスト サイズ計算
		 */
		construct.prototype.setImageBoxSize = function () {

			var areaW = 480;
			var areaH = 480;
			var img_w = $('.js-imgbox-size-rel').width();
			var img_h = Math.floor(img_w * (areaH / areaW));
			var $imgboxsize = $('.js-imgbox-size');
			var $imgboxsizeImg = $imgboxsize.find('img');
			$imgboxsize.css({'width': img_w + 'px'});
			$imgboxsize.css({'height': img_h + 'px'});
			$imgboxsizeImg.css({'max-height': img_h + 'px'});
			$imgboxsizeImg.css({'max-width': img_w + 'px'});

		};

		return construct;

	})();


})(util);
