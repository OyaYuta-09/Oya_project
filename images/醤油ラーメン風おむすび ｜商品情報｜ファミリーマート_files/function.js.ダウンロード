/**
 *
 *	FUNCTION JS
 *	/common/js/function.js
 *
 */

if(typeof util === 'undefined') var util = {};
(function () {
	"use strict;"

	$(function(){
		new Main();
	})

	/**
	 * @class Main
	 * @sumally 全ページロード時共通処理
	 */
	var Main = (function(){
		/**
		 * @constructor
		 */
		function construct() {
			var _this = this;


			_this.checkBrowser();
			_this.changeViewport();
			_this.changeFontsize();
			_this.changeTelephoneCall();
			// _this.setSpMenu();
			_this.actGrobalNavi();
			// _this.setMegaMenu();
			_this.setTabContents();
			_this.setNavSideList();
			_this.setToggleBtn();
			_this.setCheckCustom();
			_this.setFilterContents();
			_this.setNationalMap();
			//_this.setSpSlideScroll();

			_this.setLineHight();

			$(window).load(function() {

				_this.setPageScroll();
				$(window).scroll(function () {
					_this.setPageScroll();
				});

				_this.setMegaMenu();
				_this.setSpMenu();

			});

			// メガメニュー用オーバーレイ
			util.overlay = new util.setOverlay({
				opacity: 0.5,
				bgcolor: '#000'
			});

			// スムーススクロール
			$('.js-btn-pagetop').rjs_scrollbtn({speed: 600});		//ページトップ用
			$('.js-btn-pagelink').rjs_scrollbtn({speed: 600});	//ページ内リンク用
		};

		/**
		 * @sumally ブラウザ判別Class
		 */
		construct.prototype.checkBrowser = function () {

			var _this = this;

			var bp = 737;
			var bpFlg;
			var resizeTimer;

			// User Agent Class
			if(rjs.checkUA.iOS) {
				if(rjs.checkUA.iPhone) {
					$('body').addClass('ly-ua-sp');
				} else if (rjs.checkUA.iPad) {
					$('body').addClass('ly-ua-tablet');
				}
			} else if(rjs.checkUA.android) {
				if(rjs.checkUA.androidTablet) {
					$('body').addClass('ly-ua-tablet');
				} else {
					$('body').addClass('ly-ua-sp');
				}
			} else {
				$('body').addClass('ly-ua-pc');
			}

			// Browser Class
			if(rjs.checkUA.ie){
				$('body').addClass('ly-ie');
			}
			if(rjs.checkUA.ie8){
				$('body').addClass('ly-ie8');
			}
			else if(rjs.checkUA.ie9){
				$('body').addClass('ly-ie9');
			}
			else if(rjs.checkUA.firefox){
				$('body').addClass('ly-firefox');
			}

			if(rjs.checkUA.widthPC){
				bpFlg = 'pc';
			} else {
				bpFlg = 'sp';
			}

			// Device Width Class
			var _setCheckBrowser = function () {
				var w = window.innerWidth ? window.innerWidth: $(window).width();
				$('body').removeClass('ly-w-pc').removeClass('ly-w-sp');
				if (w < bp) {
					$('body').addClass('ly-w-sp');
					if (bpFlg != 'sp') {
						_this.setMegaMenu();
						_this.setAcrossBreakpoint('sp');
					}
					bpFlg = 'sp';
				} else {
					$('body').addClass('ly-w-pc');
					if (bpFlg != 'pc') {
						_setWebFontGnav();
						_this.setMegaMenu();
						_this.setAcrossBreakpoint('pc');
					}
					bpFlg = 'pc';
				}
			}

			// Global Navi WebFont Load
			var _setWebFontGnav = function () {
				if(typeof FONTPLUS !== 'undefined') {
				//	FONTPLUS.load([{'fontname':'IwaUDGoDspPro-Md{pm}', 'nickname':'loadname_mpm', 'text':'商品情報キャンペーンサービスカード・ポイントネットショッピング企業情報'}]);
				}
			}

			_setWebFontGnav();
			_setCheckBrowser();
			$(window).resize(function() {

				if (resizeTimer !== false) {
					clearTimeout(resizeTimer);
				}
				resizeTimer = setTimeout(function() {
					_setCheckBrowser();
				}, 200);

			});

		};


		/**
		 * @sumally ブレイクポイントを横断した際の初期化設定
		 */
		construct.prototype.setAcrossBreakpoint = function () {

			// オーバーレイ非表示
			if ($('.js-ov-page').length) {
				$('.js-ov-page').hide();
			}

			// SPメニュー非表示
			$('.js-head-nav-area').removeAttr('style');
			$('.ly-btn-menu').removeClass('ly-show');
			$('.js-gnav-list > li').each(function() {
				$(this).find('.js-gnav-list-link').removeClass('ly-act');
				$(this).find('.ly-wrp-mnav').hide();
			});

		};


		/**
		 * @sumally SPスライド用スクロールエリア高さ設定
		 */
		construct.prototype.setSpSlideScroll = function () {

			$spscroll = $('.js-sp-scroll');

			$(window).load(function () {

				if (rjs.checkUA.widthSP) {

					if ($spscroll.length > 0) {

						$spscroll.each(function(i) {
							var $tgt = $(this);
							var $tgtinner = $tgt.find('.js-sp-scroll-inner');
							var setH = $tgtinner.height();
							var setHinner = setH + 10;

							$tgt.css('height', setH);
							$tgtinner.css('height', setHinner);
						});

					}

				}
			});

		};


		/**
		 * @sumally タブ切り替え
		 */
		construct.prototype.setTabContents = function () {

			$tabCateList = $('.js-tab-cate-list');

			if ($tabCateList.length > 1) {
				$tabCateList.each(function() {
					var _this = $(this);
					var $tabCateChild = _this.children();

					var fid = _this.find('li:first a').attr('href');
					_this.find('li:first').addClass('ly-act');
					_this.closest('.js-tab-group').find('.js-tab-contents:not(' + fid + ')').hide();

					_this.find('li a').on('click', function(e) {
						var __this = $(this);
						var area = __this.attr('href');
						__this.closest('.js-tab-group').find('.js-tab-contents').hide();
						$(area).show();
						_this.find('li').removeClass('ly-act');
						__this.closest('li').addClass('ly-act');
						e.preventDefault();
					});

				});

			} else if ($tabCateList.length > 0) {

				$tabCateChild = $tabCateList.children();

				var fid = $('.js-tab-cate-list li:first a').attr('href');
				$('.js-tab-cate-list li:first').addClass('ly-act');
				$('.js-tab-contents:not(' + fid + ')').hide();

				$('.js-tab-cate-list li a').on('click', function(e) {
					var area = $(this).attr('href');
					$('.js-tab-contents').hide();
					$(area).show();
					$(".js-tab-cate-list li").removeClass('ly-act');
					$(this).closest('li').addClass('ly-act');
					e.preventDefault();
				});
			}

		};


		/**
		 * @sumally グロナビコンパクト
		 * @comment コンパクト版fixedグロナビはPCのみ
		 */
		construct.prototype.setPageScroll = function () {

			if ($('body').hasClass('ly-ua-pc') && $('body').hasClass('ly-w-pc')) {
				var _this = this;

				var $headerarea = $('.ly-header-area');
				var $wrapper = $('.ly-wrapper');
				var compactclass = 'ly-compact';
				var $headhldgsarea = $('.ly-head-hldgs-area');
				var headH = $headhldgsarea.height();

				var $btnpagetop = $('.ly-btn-pagetop');
				var winW = window.innerWidth ? window.innerWidth: $(window).width();
				var winH = window.innerHeight ? window.innerHeight: $(window).height();
				var pageH = $(document).height();
				var copyrightH = $('.ly-foot-flink-area').outerHeight(true);
				var stopH = pageH - winH - copyrightH;
				var pagetopclass = 'ly-pagetop-show';

				var scrollVal = $(window).scrollTop();

				// コンパクト版ヘッダ出現位置
				if (scrollVal > 0) {
					$wrapper.addClass(compactclass);
				} else {
					$wrapper.removeClass(compactclass);
				}

				// ページトップボタン出現位置
				if (scrollVal > winH) {
					$btnpagetop.addClass(pagetopclass);
				} else {
					$btnpagetop.removeClass(pagetopclass);
				}

				// ページトップボタン止め位置
				if (scrollVal > stopH) {
					setH = scrollVal - stopH + 40;
					$btnpagetop.css('bottom', setH + 'px');
				} else {
					$btnpagetop.css('bottom', '40px');
				}

			}

		};

		/**
		 * @sumally メガメニュー
		 */
		construct.prototype.setMegaMenu = function () {

			var $gnavlistlink;
			var $gnavTablistlink;
			var closeTimer = null, openTimer = null;
			var $headhldgsarea = $('.ly-head-hldgs-area');
			var headH = $headhldgsarea.height();
			var gnavOverLayFlug = false;

			$('.js-gnav-list-link').off();
			$('.js-gnav-list').children().off();

			// メガメニュー非表示
			var _closeMegaMenu = function () {
				$('.js-gnav-list-link.ly-open').next('.ly-wrp-mnav').stop(true,true).fadeOut(400);
				$('.js-gnav-list-link.ly-open').next('.ly-wrp-mnav').find('.ly-mnav-area-inner').stop(true,true).animate({opacity: 0}, 300);
				$('.js-gnav-list-link.ly-open').removeClass('ly-open');
				util.overlay.close({speed:300});
			}

			// common
			// $(window).scroll(function() {
			//	if ($('body').hasClass('ly-w-pc') > 0) {
			//		_closeMegaMenu();
			//	}
			// });

			/* ▼グロナビのオーバーレイの高さ計算用 */
			function setBodyHeight (){
				var tempBodyHeight = util.getSize.bodyH();
				var tempHeadHeight = util.getSize.headH();
				var setHeight = tempBodyHeight;
				$('.js-ov-page').height(setHeight);
				$('.js-ov-page').css('top' , 0);
			}
			/* グロナビのオーバーレイの高さ計算用 END */

			// for tablet
			$(document).on('click', '.ly-ua-tablet .js-ov-page', function() {
				_closeMegaMenu();
			});

			$gnavTablistlink = $('.ly-w-pc.ly-ua-tablet .js-gnav-list-link');
			$gnavTablistlink.on('click', function(e) {
				var _this = $(this);
				var _openFlg = false;

				if (_this.hasClass('ly-open')) {
					_this.removeClass('ly-open');
					_this.next('.ly-wrp-mnav').stop(true,true).fadeOut(400);
					_this.next('.ly-wrp-mnav').find('.ly-mnav-area-inner').stop(true,true).animate({opacity: 0}, 300);
					util.overlay.close({speed:300, complete:function(){
						//_openFlag = true;
					}});
				} else {
					$('.js-gnav-list-link').each(function() {
						if ($(this).hasClass('ly-open')) {
							_openFlg = true;

							$(this).removeClass('ly-open');
							$(this).next('.ly-wrp-mnav').stop(true,true).fadeOut(400);
							$(this).next('.ly-wrp-mnav').find('.ly-mnav-area-inner').stop(true,true).animate({opacity: 0}, 400);
							_this.addClass('ly-open');
							_this.next('.ly-wrp-mnav').stop(true,true).fadeIn(400);
							_this.next('.ly-wrp-mnav').find('.ly-mnav-area-inner').stop(true,true).animate({opacity: 1}, 400);
							e.preventDefault();
						}
					});

					if (!_openFlg) {
						_this.addClass('ly-open');
						_this.next('.ly-wrp-mnav').stop(true,true).fadeIn(400);
						_this.next('.ly-wrp-mnav').find('.ly-mnav-area-inner').stop(true,true).animate({opacity: 1}, 400);

						util.overlay.open({speed:400, complete:function(){
							//_openFlag = true;
						}});
					}
				}
				e.preventDefault();
			});

			// for pc
			$gnavlistlink = $('.ly-w-pc.ly-ua-pc .js-gnav-list').children();
			$gnavlistlink.on({
				'mouseenter':function(e){

					var _this = $(this);
					var _tgt = _this.find('.js-gnav-list-link');
					var _openFlg = false;

					function megaMenuOpen() {

						if ($('body').hasClass('ly-w-pc')) {
							$('.js-gnav-list-link').each(function() {
								if ($(this).hasClass('ly-open')) {
									$(this).removeClass('ly-open');
									$(this).next('.ly-wrp-mnav').stop().fadeOut(400);
									$(this).next('.ly-wrp-mnav').find('.ly-mnav-area-inner').stop().animate({opacity: 0}, 400);

									_tgt.addClass('ly-open');
									_tgt.next('.ly-wrp-mnav').stop().fadeIn(400);
									_tgt.next('.ly-wrp-mnav').find('.ly-mnav-area-inner').stop().animate({opacity: 1}, 400);
									_openFlg = true;
								}
							});
						}

						if (!_openFlg) {
							_tgt.addClass('ly-open');
							_tgt.next('.ly-wrp-mnav').stop().fadeIn(400);
							_tgt.next('.ly-wrp-mnav').find('.ly-mnav-area-inner').stop().animate({opacity: 1}, 400);
						}

						util.overlay.open({speed:250, complete:function(){
						}});

					}
					/* ▼オーバーレイの高さ調整 */
					if(!gnavOverLayFlug) {
						setBodyHeight();
						gnavOverLayFlug = true;
					}
					/* /オーバーレイの高さ調整 END */

					clearTimeout(closeTimer);
					closeTimer = null;

					openTimer = setTimeout( function() {
						megaMenuOpen();
					}, 400);

				},
				'mouseleave':function(e){

					var _this = $(this);
					var _tgt = _this.find('.js-gnav-list-link');

					function megaMenuClose() {
						_tgt.removeClass('ly-open');
						_tgt.next('.ly-wrp-mnav').stop().fadeOut(300, function() {
						});
						_tgt.next('.ly-wrp-mnav').find('.ly-mnav-area-inner').stop().animate({opacity: 0}, 300);

						util.overlay.close({speed:200, complete:function(){
						}});
					}

					clearTimeout(openTimer);
					openTimer = null;

					closeTimer = setTimeout( function() {
						megaMenuClose();
					}, 400);

				}
			});

			// for sp
			$gnavlistlink = $('.ly-w-sp .js-gnav-list-link');
			$gnavlistlink.on('click', function(e) {

				var _this = $(this);

				if (_this.hasClass('ly-open')) {
					_this.removeClass('ly-open');
					_this.next('.ly-wrp-mnav').stop().slideUp(300);
					_this.next('.ly-wrp-mnav').find('.ly-mnav-area-inner').stop().animate({opacity: 0}, 300);
				} else {
					_this.addClass('ly-open');
					_this.next('.ly-wrp-mnav').stop().slideDown(400);
					_this.next('.ly-wrp-mnav').find('.ly-mnav-area-inner').stop().animate({opacity: 1}, 400);
				}
				e.preventDefault();

			});

		};


		/**
		 * @sumally グロナビアクティブClass
		 */
		construct.prototype.actGrobalNavi = function () {

			var targetGnav = $('.js-gnav-list > li');
			var myurl = document.URL;
			var mydir = myurl.split('/');
			var nowhtml;
			var nowpass = location.pathname;
			nowpass = nowpass.replace('/content/familymart/family/', '');
			var dirs = nowpass.split('/');
			var nowdir = dirs[0];

			var nowdomain = location.protocol + '//' + location.host;

			// グロナビ
			if (dirs.length > 1) {
				var nowdirroot = '/' + nowdir + '/';
				// PC
				$('.js-gnav-list > li').each(function() {
					var thishref = $(this).find('a').attr('href');
					thishref = thishref.replace('/content/familymart/family', '');
					var thisclass = $(this).attr('class');
					if (nowdirroot == thishref) {
						$(this).addClass('ly-act');
					}
				});
			}

		};

		/**
		 * @sumally 文字サイズ変更class
		 */
		construct.prototype.changeFontsize = function () {

			var $changeTxt  = $('.js-fsize-switch a');
			var $changeTxtL = $('.js-ly-sizeL');
			var $changeTxtM = $('.js-ly-sizeM');
			var $changeTxtS = $('.js-ly-sizeS');
			var classSizeS  = 'ly-sizeS';
			var classSizeM  = 'ly-sizeM';
			var classSizeL  = 'ly-sizeL';
			var classAct    = 'ly-act';

			// ロード時
			if ($.cookie('TEXT_SIZE') == classSizeL) {
				$('html').addClass(classSizeL);
				$changeTxtL.parent().addClass(classAct);
			} else if ($.cookie('TEXT_SIZE') == classSizeS) {
				$('html').addClass(classSizeS);
				$changeTxtS.parent().addClass(classAct);
			} else {
				$('html').removeClass(classSizeL).removeClass(classSizeS);
				$changeTxtM.parent().addClass(classAct);
			}

			// リンククリック時
			$changeTxt.on('click', function(e) {
				e.preventDefault();

				// class名からトリガー用の余分を削除
				var textSize = $(this).attr('class').replace('js-', '').replace(' ly-act', '');

				$('html').removeClass().addClass(textSize);
				$changeTxt.closest('li').removeClass(classAct);

				$(this).closest('li').addClass(classAct);

				// cookieを保存
				$.cookie('TEXT_SIZE', textSize, {
					path: '/',
					expires: 10000  // 保存日数
				});

				if ($.cookie('TEXT_SIZE') == classSizeL) {
					$changeTxtL.addClass(classAct);
				} else {
					$changeTxtS.addClass(classAct);
				}
			});

		};

		/**
		 * @sumally 電話番号にリンクを張る
		 */
		construct.prototype.changeTelephoneCall = function () {

			if (rjs.checkUA.iPhone == true || rjs.checkUA.android == true) {
				$('span[data-action=call]').each(function() {
					var $elm = $(this);
					$elm.wrap('<a href="tel:' + $elm.data('tel') + '"></a>');
				});
			}

		};

		/**
		 * @sumally タブレット閲覧時にViewportを変更
		 */
		construct.prototype.changeViewport = function () {

			var ua = navigator.userAgent;
			if (
				ua.search('Android') != -1 && ua.search('Mobile') == -1 ||
				ua.search('iPad') != -1
			) {
				$('meta[name=viewport]').attr('content', 'width=1280');
				$('body').css('min-width', '1280px');
			}

		};

		/**
		 * @sumally SPメニューモーダル
		 */
		construct.prototype.setSpMenu = function (expandSpeed) {

			expandSpeed || (expandSpeed = 500);
			var $spmenu = $('.js-spmenu');
			var $spmenu_btn = $('.js-spmenu a');
			var $spclosemenu_btn = $('.js-spmenu-close');
			var $headnavarea = $('.js-head-nav-area');
			var headertH = 60;
			var gnavOverLayFlug = false;

			/* ▼グロナビのオーバーレイの高さ計算用 */
			function setBodyHeight (){
				var tempBodyHeight = util.getSize.bodyH();
				var tempHeadHeight = util.getSize.headH();
				var setHeight = tempBodyHeight - tempHeadHeight;
				$('.js-ov-page').height(setHeight);
			}
			/* グロナビのオーバーレイの高さ計算用 END */



			// メニュー クリック
			$spmenu_btn.off('click');
			$spmenu_btn.on('click', function(e){
				var cls = $(this).closest('.ly-btn-menu').attr('class');
				if(cls.indexOf('ly-show') === -1){
					var cls2 = $spclosemenu_btn.attr('class');
					$spmenu.addClass('ly-show');
					$headnavarea.slideDown(expandSpeed, 'easeOutCubic');
					util.overlay.open({speed:400, complete:function(){
					}});
				} else {
					$spmenu.removeClass('ly-show');
					$headnavarea.slideUp(expandSpeed,'easeOutCubic',
						function(){
							$('.js-gnav-list-link').each(function() {
								if ($(this).hasClass('ly-act')) {
									$(this).removeClass('ly-act');
									$(this).next('.ly-wrp-mnav').stop().slideUp(300);
								}
							});
							$(this).removeAttr('style');
						}
					);
					util.overlay.close({speed:200, complete:function(){
					}});
				}
				/* ▼オーバーレイの高さ調整 */
				if(!gnavOverLayFlug) {
					setBodyHeight();
					gnavOverLayFlug = true;
				}
				/* /オーバーレイの高さ調整 END */

				e.preventDefault();
			});
			// 閉じる クリック
			$spclosemenu_btn.off('click');
			$spclosemenu_btn.on('click', function(e){
				$headnavarea.slideUp(expandSpeed,'easeOutCubic',
					function(){
						$spmenu.removeClass('ly-show');
						$('.js-gnav-list-link').each(function() {
							if ($(this).hasClass('ly-act')) {
								$(this).removeClass('ly-act');
								$(this).next('.ly-wrp-mnav').stop().slideUp(300);
							}
						});
						$(this).removeAttr('style');
					}
				);
				util.overlay.close({speed:200, complete:function(){
				}});
				$('body,html').animate({ scrollTop: 0 }, expandSpeed, 'easeOutCubic');

				e.preventDefault();
			});

		};

		/**
		 * @sumally SPフッターローカルナビリスト
		 * 第二階層のみを表示するためのクラス追加
		 */
		construct.prototype.setNavSideList = function () {

			$navfoot = $('.js-nav-side');

			if ($navfoot.length > 0 && rjs.checkUA.widthSP) {

				var clm_sp = 2;
				var add_sp_tmp = '';

				if ($('.js-nav-side > .ly-list-first > .ly-open').length > 0) {
					// 第二階層あり
					$('.js-nav-side').addClass('ly-nav-side-level2');
				}

			}

		};


		/**
		 * @sumally トグル表示/非表示処理
		 */
		construct.prototype.setToggleBtn = function (expandSpeed) {
			expandSpeed || (expandSpeed = 500);
			var exceptFlg = false;
			var $expand_btn = $('.js-toggle-btn');
			var $except_btn = $('.js-toggle-except');
			$expand_btn.on('click',
				function(e){
					if (!exceptFlg) {
						var $expandClass = $(this).closest('.js-toggle-group').attr('class');
						if($expandClass.indexOf('js-toggle-open') === -1){
							$(this).closest('.js-toggle-group').find('.js-toggle-area').slideDown(expandSpeed,
								function(){
									$(this).closest('.js-toggle-group').addClass('js-toggle-open').removeClass('js-toggle-close');
								}
							);
						}else{
							$(this).closest('.js-toggle-group').find('.js-toggle-area').slideUp(expandSpeed,
								function(){
									$(this).closest('.js-toggle-group').removeClass('js-toggle-open').addClass('js-toggle-close');
								}
							);
						}
						e.preventDefault();
					}
					exceptFlg = false;
				}
			);
			$except_btn.on('click', function() {
				exceptFlg = true;
			});

			// デフォルト開閉設定（SP時は閉じる）
			if ($('body').hasClass('ly-w-sp')) {
				$('.js-toggle-group').removeClass('js-toggle-open').addClass('js-toggle-close');
				$('.js-toggle-area').hide();
			}

			// メガメニュー内の子要素はトグルさせない
			$('.js-head-nav-area .js-toggle-btn').off();
		};


		/**
		 * @sumally チェックボックスカスタマイズ
		 */
		construct.prototype.setCheckCustom = function () {
			var $inputCheck = $('.ly-input-checkbox');

			if ($inputCheck.length) {
				$inputCheck.on('click', function() {
					if(this.checked){
						$(this).parent('label').addClass('ly-act');
						$(this).closest('.ly-with-input-text').addClass('ly-act');
					} else {
						$(this).parent('label').removeClass('ly-act');
						$(this).closest('.ly-with-input-text').removeClass('ly-act');
					}
				});
				$inputCheck.each(function() {
					if($(this).is(':checked')){
						$(this).parent('label').addClass('ly-act');
					}
				});
			}

			var $inputRadio = $('.ly-input-radio');

			if ($inputRadio.length) {
				$inputRadio.on('click', function() {
					var tgt_name = $(this).attr('name');//console.log($inputRadio.index(this));
					var _this = $(this);
					$('input[name=' + tgt_name + ']').parent('label').removeClass('ly-act');
					$('input[name=' + tgt_name + ']').closest('.ly-with-input-text').removeClass('ly-act');
					_this.parent('label').addClass('ly-act');
					_this.closest('.ly-with-input-text').addClass('ly-act');
					//_this.addClass('ly-act');
				});

				// 初期化
				$inputRadio.each(function(i) {
					if($(this).is(':checked')){
						$(this).parent('label').addClass('ly-act');
						//$(this).addClass('ly-act');
					}
				});
			}
		};


		/**
		 * @sumally モジュール用高さ揃え
		 */
		construct.prototype.setLineHight = function () {
			$(window).load(function() {

				// mod-layout-bdrclm2
				var $bdrclm2Set = $('.ly-mod-layout-bdrclm2 .js-layout-detail');
				if ($bdrclm2Set.length > 0 && rjs.checkUA.widthPC) {
					$bdrclm2Set.rjs_hlg({ colmax:2 });
				}

			});
		};


		/**
		 * @sumally 情報絞り込み
		 *
		 */
		construct.prototype.setFilterContents = function () {

			var _this = this;
			var $tab = $('.js-filter-tab');
			var $tgtcts = $('.js-filter-content');
			var cls = 0;
			var src = 1;
			var alldata = [];
			alldata[cls] = [];
			alldata[src] = [];

			var dispatcher = $({}); // イベント管理用オブジェクト
			var tgtcate = ''; // filter対象

			var _setFilterTab = function (value) {
				tgtcate = value;
				dispatcher.trigger('dataFilter');
			}

			// 絞り込み全データの取得
			$tgtcts.each(function(i) {
				_this = $(this);
				alldata[cls][i] = [];
				alldata[src][i] = [];

				_this.find('.js-filter-blk').each(function(j) {
					alldata[cls][i].push($(this).attr('class'));
					alldata[src][i].push($(this).prop('outerHTML'));
				});
			});

			// 絞り込み表示
			var _updateFilter = function () {

				var appdata; // 絞り込みデータ出力変数

				// tab現在地表示
				$tab.find('li').removeClass('ly-act');
				$tab.find('li.ly-cate-' + tgtcate).addClass('ly-act');

				// 絞り込みデータの表示
				$tgtcts.empty();
				$tgtcts.each(function(i) {
					_this = $(this);
					appdata = '';

					$.each(alldata[cls][i], function(j, value) {
						if (alldata[cls][i][j].indexOf(tgtcate) > 0) {
							appdata += alldata[src][i][j];
						}
					});

					if (appdata == '') {
						_this.append('<div class="ly-mod-result-no js-load-wfont-r"><p>該当なし</p></div>');
					//	FONTPLUS.load([{'fontname':'IwaUDGoDspPro-Th', 'nickname':'loadname_r', 'text':'該当なし'}]);
					} else {
						_this.append(appdata);
					}
				});

				if ($('.js-more-contents .js-btn-more').length) {
					util.showMore.show();
				}

			}

			// dataFilterイベント登録
			dispatcher.on('dataFilter', _updateFilter);

			// タブ押下時絞り込み
			$tab.find('a').on('click', function(e) {
				_setFilterTab($(this).attr('href').replace('#js-filter-',''));
				e.preventDefault();
			});

			// ページ遷移時
            /*
			if ($tgtcts.length) {
				if (location.hash == '') {
					$tab.find('li:first-child').addClass('ly-act');
					_setFilterTab($tab.find('li:first-child a').attr('href').replace('#js-filter-',''));
				} else {
					_setFilterTab(location.hash.replace('#',''));
				}
			}
            */

            if ($tgtcts.length) {
				if (location.search == '') {
					$tab.find('li:first-child').addClass('ly-act');
				} else {
					if(location.search.indexOf('?js-filter-') > -1){
						_setFilterTab(location.search.replace('?',''));
						$tab.find('li.ly-cate-' + location.search.replace('?js-filter-','')).addClass('ly-act');
					}else{
						$tab.find('li:first-child').addClass('ly-act');
					}
				}
			}

		};


		/**
		 * @sumally 地図切替
		 */
		construct.prototype.setNationalMap = function () {

			var $doc = $(document);
			var dispatcher = $({}); // イベント管理用オブジェクト
			var tgtarea = ''; // 対象エリア
			var tgtevent = ''; // 対象イベント

			// for PC
			var _setChangePref = function (value) {
				tgtarea = value;
				dispatcher.trigger('eveDataMap');
				dispatcher.trigger('eveDataPref');
			}
			var _setChangeMap = function (value) {
				tgtarea = value;
				dispatcher.trigger('eveDataMap');
			}
			var _setResetPref = function () {
				dispatcher.trigger('eveResetPref');
			}

			// 地図切替
			var _updateMap = function () {
				$('.js-map-contents').addClass('ly-bg-' + tgtevent + '-' + tgtarea);
			}
			// 都道府県表示
			var _showPref = function () {
				$('.js-map-contents').addClass('ly-pref-act');
				$('.js-map-contents').find('.ly-map-' + tgtarea + ' .ly-wrp-map-pref').addClass('ly-act');
				$('.js-btn-backarea').addClass('ly-act');
			}
			// 都道府県非表示
			var _hidePref = function () {
				 if (rjs.checkUA.safari) {
					$('.ly-wrp-map-pref').animate({'opacity': '0'}, 200,
						function() {
							$('.ly-wrp-map-pref').removeClass('ly-act');
							$('.js-map-contents').removeClass('ly-pref-act');
							$('.js-btn-backarea').removeClass('ly-act');
							$('.js-map-contents').removeClass('ly-bg-click-' + tgtarea);
							$('.ly-wrp-map-pref').css({'opacity': '1'});
						});
				 } else {
					$('.ly-wrp-map-pref').removeClass('ly-act');
					$('.js-map-contents').removeClass('ly-pref-act');
					$('.js-btn-backarea').removeClass('ly-act');
					$('.js-map-contents').removeClass('ly-bg-click-' + tgtarea);
				}
			}

			// dataFilterイベント登録
			dispatcher.on('eveDataMap', _updateMap);
			dispatcher.on('eveDataPref', _showPref);
			dispatcher.on('eveResetPref', _hidePref);

			// エリアボタン押下時
			$doc.on('click', '.ly-w-pc .js-btn-area', function(e) {

				var cls = $(this).parent().attr('class');
				cls = cls.replace('ly-map-', '');
				tgtevent = 'click';
				_setChangePref(cls);

				e.preventDefault();
			});
			// 都道府県箇所の外側を押下時
			//$doc.on('click', '.ly-w-pc .ly-wrp-national-map', function(e) {
			$('.ly-w-pc .ly-wrp-national-map').on('click', function(e) {
				if (!$(e.target).closest('a').length) {
					if (!$(e.target).closest('.ly-wrp-map-pref').length) {
						if ($('.js-map-contents').hasClass('ly-pref-act')) {
							_setResetPref();
						}
					}
					e.preventDefault();
				}
			});
			// 戻るボタン押下時
			$doc.on('click', '.js-btn-backarea', function(e) {
				_setResetPref();
				e.preventDefault();
			});

			// エリアボタンホバー
			$('.ly-w-pc .js-btn-area').on({
				'mouseenter':function(e){
					var cls = $(this).parent().attr('class');
					cls = cls.replace('ly-map-', '');
					tgtevent = 'hovr';
					_setChangeMap(cls);
				},
				'mouseleave':function(e){
					$('.js-map-contents').removeClass('ly-bg-hovr-' + tgtarea);
				}
			});

			// for SP
			$doc.on('click',　'.ly-w-sp .js-btn-area', function(e) {

				var _this = $(this);

				if (_this.hasClass('ly-open')) {
					_this.removeClass('ly-open');
					_this.next('.ly-wrp-map-pref').stop().slideUp(300);
				} else {
					_this.addClass('ly-open');
					_this.next('.ly-wrp-map-pref').stop().slideDown(400);
				}
				e.preventDefault();

			});

		};

		return construct;

	})();


	/**
	 * @class size
	 * @sumally サイズ取得用
	 * util.getSize.winW();
	 * -------------------------------------------------------------------------- */
	util.getSize = (function(){
		/**
		 * @constructor
		 */
		function construct() {};

		/**
		 * @sumally window width取得
		 */
		construct.prototype.winW = function () {
			return window.innerWidth ? window.innerWidth: $(window).width();
		};

		/**
		 * @sumally window height取得
		 */
		construct.prototype.winH = function () {
			return window.innerHeight ? window.innerHeight: $(window).height();
		};

		/**
		 * @sumally body height取得
		 */
		construct.prototype.bodyH = function () {
			return Math.max.apply( null, [document.body.clientHeight , document.body.scrollHeight, document.documentElement.scrollHeight, document.documentElement.clientHeight] );
		};

		/**
		 * @sumally header height取得
		 */
		construct.prototype.headH = function () {
			return $('#header').height();
		};

		return new construct;
	})();


	/**
	 * @class setOverlay
	 * @sumally オーバーレイ
	 * util.setOverlay();
	 * -------------------------------------------------------------------------- */
	util.setOverlay = (function(){
		var defaults = {
			opacity: 0.7,
			bgcolor: '#000000',
			complete: false,
		};
		/**
		 * @constructor
		 */
		function construct(options) {
			if(!(this instanceof construct)) throw new TypeError('Constructor cannot be called as a function.');
			var _this = this;
			this.obj = $.extend({}, defaults, options);
			this.fileType;

			// overlay set
			$('body').append('<div class="ly-ov-page js-ov-page"></div>');
			this.overlay = $('.js-ov-page');
			this.overlay.css({
				display: 'none',
				position: 'absolute',
				top: util.getSize.headH(),
				left: '0px',
				right: '0px',
				bottom: '0px',
				height: util.getSize.bodyH() - util.getSize.headH(),
				'background-color': this.obj.bgcolor,
				'z-index': '90',
				opacity: 0
			});
		};

		/**
		 * @sumally open
		 */
		construct.prototype.open = function (options) {
			var _this = this;
			var _def = {
				speed: 600,
				easing: 'easeOutCubic'
			};
			var _set = $.extend({}, _def, options);

			if(rjs.checkUA.iOS || rjs.checkUA.android) {
				this.overlay.css('width', util.getSize.winW())
			}

			this.overlay
				.css('display', 'block')
				.stop()
				.animate({'opacity' : this.obj.opacity}, {'duration': _set.speed, 'easing': _set.easing,
					'complete':function(){
						if(_set.complete) _set.complete();
					}
			});
		};

		/**
		 * @sumally close
		 */
		construct.prototype.close = function (options) {
			var _this = this;
			var _def = {
				speed: 600,
				easing: 'linear'
			};
			var _set = $.extend({}, _def, options);

			this.overlay
			.stop()
			.animate({'opacity' : 0}, {'duration': _set.speed, 'easing': _set.easing,
				'complete': function(){
					_this.overlay.css('display', 'none');
					if(_set.complete) _set.complete();
				}
			});
		};

		return construct;
	})();


	/**
	 * @class showMore
	 * @sumally もっと見るボタン
	 * util.showMore.show();
	 * -------------------------------------------------------------------------- */
	util.showMore = (function(){

		function construct() {};

		/**
		 * @sumally show
		 */
		construct.prototype.show = function (options) {
			var _this = this;
			var _def = {
				maxPc: 10,
				maxSp: 5
			};
			var _set = $.extend({}, _def, options);

			var $moreContents = $('.js-more-contents');
			var $btnMore = $('.js-btn-more');
			var _max_len;
			var _item_len;

			if ( $('.ly-w-pc.ly-ua-pc').length) {
				_max_len = _set.maxPc;
			} else {
				_max_len = _set.maxSp;
			}

			// 指定件数未満の場合、ボタン非表示
			$moreContents.each(function(i) {
				_item_len = $(this).find('.js-filter-blk').length;
				if (_item_len > _max_len) {
					$(this).find('.js-btn-more').show();
				} else {
					$(this).find('.js-btn-more').hide();
				}
			});

			// 指定件数以降を表示し、ボタン非表示
			$btnMore.off('click');
			$btnMore.on('click', function(e) {
				$(this).closest('.js-more-contents').find('.js-filter-blk').fadeIn(500);
				$(this).hide();
				e.preventDefault();
			});

		};

		return new construct;

	})();

	/* 言語プルダウン開 */
	$(function () {
		$('.ly-lang-switch').on('click', function () {
			$(this).closest('dl').toggleClass('ly-active');
		});
	});
})(util);
